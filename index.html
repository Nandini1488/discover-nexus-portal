<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discover Nexus Portal</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        .news-card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* shadow-md */
            overflow: hidden;
            transition: transform 0.2s ease-in-out;
        }
        .news-card:hover {
            transform: translateY(-5px);
        }
        .news-image {
            width: 100%;
            height: 180px; /* Fixed height for consistency */
            object-fit: cover; /* Ensures image covers the area */
            border-radius: 0.75rem 0.75rem 0 0; /* Rounded top corners */
        }
        .category-section {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .tab-button.active {
            background-color: #4f46e5; /* Indigo 600 */
            color: #ffffff;
        }
        .tab-button {
            transition: background-color 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100">

    <header class="bg-indigo-700 text-white p-4 shadow-md">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
            <h1 class="text-3xl font-bold mb-2 md:mb-0">Discover Nexus Portal</h1>
            <nav>
                <ul id="region-tabs" class="flex flex-wrap justify-center md:justify-end space-x-2 md:space-x-4">
                    <!-- Region tabs will be dynamically loaded here -->
                </ul>
            </nav>
        </div>
    </header>

    <main class="container mx-auto p-4 mt-4">
        <!-- Timestamp display -->
        <div id="last-updated-timestamp" class="text-sm text-gray-500 text-center mb-4">Loading...</div>

        <!-- Category tabs -->
        <div class="bg-white p-4 rounded-xl shadow-md mb-6">
            <div id="category-tabs" class="flex flex-wrap justify-center space-x-2 md:space-x-4">
                <!-- Category tabs will be dynamically loaded here -->
            </div>
        </div>

        <!-- News content sections -->
        <div id="news-content" class="grid grid-cols-1 gap-6">
            <!-- News articles will be dynamically loaded here -->
        </div>
    </main>

    <footer class="bg-gray-800 text-white p-4 text-center mt-8">
        <p>&copy; 2024 Discover Nexus Portal. All rights reserved.</p>
    </footer>

    <script>
        // Define regions and categories - MUST match Python script's keys
        const REGIONS = {
            "global": {"name": "Global"},
            "north_america": {"name": "North America"},
            "europe": {"name": "Europe"},
            "asia": {"name": "Asia"},
            "africa": {"name": "Africa"},
            "oceania": {"name": "Oceania"},
            "south_america": {"name": "South America"},
            "middle_east": {"name": "Middle East"},
            "southeast_asia": {"name": "Southeast Asia"},
            "north_africa": {"name": "North Africa"},
            "sub_saharan_africa": {"name": "Sub-Saharan Africa"},
            "east_asia": {"name": "East Asia"},
            "south_asia": {"name": "South Asia"},
            "australia_nz": {"name": "Australia & NZ"}
        };

        const CATEGORIES = {
            "news": "News",
            "technology": "Technology",
            "finance": "Finance",
            "travel": "Travel",
            "world": "World",
            "weather": "Weather",
            "blogs": "Blogs"
        };

        let allNewsData = {}; // Stores all fetched news data
        let currentRegion = 'global'; // Default selected region
        let currentCategory = 'news'; // Default selected category

        // Function to fetch and process news data
        async function fetchNewsData() {
            try {
                // Use the absolute URL for updates.json
                const response = await fetch('https://Nandini1488.github.io/discover-nexus-portal/updates.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                allNewsData = await response.json();
                console.log("Successfully fetched and parsed updates.json:", allNewsData);

                // Display last updated timestamp
                const timestampDiv = document.getElementById('last-updated-timestamp');
                if (allNewsData.last_updated_utc) {
                    const date = new Date(allNewsData.last_updated_utc);
                    timestampDiv.textContent = `Last updated: ${date.toLocaleString()}`;
                } else {
                    timestampDiv.textContent = 'Last updated: N/A (Timestamp not found)';
                }

                renderTabs();
                renderNews(); // Initial render of news content
            } catch (error) {
                console.error('Error fetching or parsing updates.json:', error);
                document.getElementById('last-updated-timestamp').textContent = 'Error loading content.';
                document.getElementById('news-content').innerHTML = '<p class="text-red-600 text-center">Failed to load news content. Please try again later.</p>';
            }
        }

        // Function to render region and category tabs
        function renderTabs() {
            const regionTabsContainer = document.getElementById('region-tabs');
            regionTabsContainer.innerHTML = ''; // Clear existing tabs
            for (const key in REGIONS) {
                const li = document.createElement('li');
                const button = document.createElement('button');
                button.textContent = REGIONS[key].name;
                button.className = `tab-button px-4 py-2 rounded-lg font-semibold ${key === currentRegion ? 'active bg-indigo-600 text-white' : 'bg-indigo-500 text-white hover:bg-indigo-600'}`;
                button.onclick = () => {
                    currentRegion = key;
                    renderTabs(); // Re-render tabs to update active state
                    renderNews(); // Re-render news for new region
                };
                li.appendChild(button);
                regionTabsContainer.appendChild(li);
            }

            const categoryTabsContainer = document.getElementById('category-tabs');
            categoryTabsContainer.innerHTML = ''; // Clear existing tabs
            for (const key in CATEGORIES) {
                const li = document.createElement('li');
                const button = document.createElement('button');
                button.textContent = CATEGORIES[key];
                button.className = `tab-button px-4 py-2 rounded-lg font-semibold ${key === currentCategory ? 'active bg-indigo-600 text-white' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`;
                button.onclick = () => {
                    currentCategory = key;
                    renderTabs(); // Re-render tabs to update active state
                    renderNews(); // Re-render news for new category
                };
                li.appendChild(button);
                categoryTabsContainer.appendChild(li);
            }
        }

        // Function to render news articles based on current region and category
        function renderNews() {
            const newsContentContainer = document.getElementById('news-content');
            newsContentContainer.innerHTML = ''; // Clear existing news articles

            const articles = allNewsData[currentRegion] && allNewsData[currentRegion][currentCategory]
                ? allNewsData[currentRegion][currentCategory]
                : [];

            if (articles.length === 0) {
                newsContentContainer.innerHTML = `<p class="text-gray-600 text-center py-8">No articles available for ${REGIONS[currentRegion].name} - ${CATEGORIES[currentCategory]}.</p>`;
                return;
            }

            // Create a grid for news cards
            const gridDiv = document.createElement('div');
            gridDiv.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6';

            articles.forEach(article => {
                const card = document.createElement('div');
                card.className = 'news-card flex flex-col'; // Use flexbox for card content
                
                // Image container with fallback
                const img = document.createElement('img');
                img.src = article.imageUrl || 'https://placehold.co/600x400/CCCCCC/333333?text=Image+Missing';
                img.alt = article.title;
                img.className = 'news-image';
                img.onerror = function() {
                    this.onerror=null; // Prevent infinite loop if fallback also fails
                    this.src='https://placehold.co/600x400/CCCCCC/333333?text=Image+Error';
                };

                const contentDiv = document.createElement('div');
                contentDiv.className = 'p-4 flex flex-col flex-grow'; // flex-grow to push footer to bottom

                const title = document.createElement('h2');
                title.className = 'text-xl font-semibold text-gray-900 mb-2';
                title.textContent = article.title;

                const summary = document.createElement('p');
                summary.className = 'text-gray-700 text-sm mb-4 flex-grow'; // flex-grow for summary
                summary.textContent = article.content;

                const link = document.createElement('a');
                link.href = article.link;
                link.target = '_blank'; // Open in new tab
                link.rel = 'noopener noreferrer';
                link.className = 'inline-block bg-indigo-500 text-white px-4 py-2 rounded-md hover:bg-indigo-600 transition-colors duration-200 mt-auto'; // mt-auto to push to bottom
                link.textContent = 'Read More';

                contentDiv.appendChild(title);
                contentDiv.appendChild(summary);
                contentDiv.appendChild(link);

                card.appendChild(img);
                card.appendChild(contentDiv);
                gridDiv.appendChild(card);
            });

            newsContentContainer.appendChild(gridDiv);
        }

        // Fetch data when the page loads
        document.addEventListener('DOMContentLoaded', fetchNewsData);
    </script>
</body>
</html>
